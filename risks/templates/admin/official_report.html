<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Official Risk Report</title>
    <style>
        /* LANDSCAPE MODE */
        @page { size: A4 landscape; margin: 1cm; }
        
        /* 1. INCREASED BASE FONT SIZE */
        body { 
            font-family: 'Times New Roman', Times, serif; 
            color: #000; 
            padding: 20px; 
            max-width: 100%; 
            margin: 0 auto; 
        }
        
        .header { text-align: center; border-bottom: 2px solid #000; padding-bottom: 15px; margin-bottom: 25px; }
        .logo-text { font-size: 28px; font-weight: bold; text-transform: uppercase; }
        .sub-text { font-size: 16px; color: #333; margin-top: 5px; font-weight: bold; }
        
        /* 2. INCREASED TABLE FONT SIZE */
        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; font-size: 14px; }
        th, td { border: 1px solid #000; padding: 8px; text-align: left; vertical-align: top; }
        
        /* HEADER COLORS */
        .head-gray { background-color: #f0f0f0; font-weight: bold; font-size: 14px; }
        .head-inherent { background-color: #e3f2fd; text-align: center; font-weight: bold; border-bottom: 2px solid #000; font-size: 14px; }
        .head-residual { background-color: #e8f5e9; text-align: center; font-weight: bold; border-bottom: 2px solid #000; font-size: 14px; }
        
        /* RATING COLORS */
        .rating-Critical { background-color: #ffebee; color: #c62828; font-weight: bold; }
        .rating-Severe { background-color: #fff3e0; color: #ef6c00; font-weight: bold; }
        .rating-Moderate { background-color: #fffde7; color: #f9a825; font-weight: bold; }
        .rating-Sustainable { background-color: #e8f5e9; color: #2e7d32; font-weight: bold; }
        
        /* SIGNATURES */
        .signatures { display: flex; justify-content: space-between; margin-top: 50px; page-break-inside: avoid; }
        .sig-block { width: 30%; border-top: 2px solid #000; padding-top: 10px; text-align: center; font-size: 14px; font-weight: bold; }

        /* ADMIN CONTROLS */
        .admin-controls { background: #e3f2fd; padding: 15px; border: 1px solid #2196f3; margin-bottom: 20px; border-radius: 5px; }
        textarea { width: 100%; height: 80px; padding: 10px; font-family: inherit; font-size: 14px; }
        .save-btn { background: #2196f3; color: white; border: none; padding: 8px 15px; cursor: pointer; font-weight: bold; font-size: 14px; }

        .print-btn-container { text-align: right; margin-bottom: 15px; }
        .print-btn { background-color: #007bff; color: white; border: none; padding: 10px 20px; cursor: pointer; border-radius: 5px; font-weight: bold; font-size: 14px; }

        @media print {
            .print-btn-container, .admin-controls { display: none; }
            body { padding: 0; margin: 0; width: 100%; }
            
            /* FORCE PRINT COLORS */
            .rating-Critical { background-color: #ffebee !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
            .rating-Severe { background-color: #fff3e0 !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
            .rating-Moderate { background-color: #fffde7 !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
            .rating-Sustainable { background-color: #e8f5e9 !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
            .head-inherent { background-color: #e3f2fd !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
            .head-residual { background-color: #e8f5e9 !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
        }
    </style>
</head>
<body>

    <div class="print-btn-container">
        <button onclick="window.print()" class="print-btn">üñ®Ô∏è PRINT LANDSCAPE REPORT</button>
    </div>

    <div class="header">
        <div class="logo-text">Bank Risk Management System</div>
        <div class="sub-text">Enterprise Risk Register & Audit Report</div>
        <div class="sub-text">Generated on: {{ generated_at|date:"F j, Y, g:i a" }} | By: {{ generated_by }}</div>
    </div>

    <h3>Executive Summary</h3>
    {% if is_admin %}
        <form method="POST" class="admin-controls">
            {% csrf_token %}
            <label style="font-weight:bold; display:block; margin-bottom:5px;">‚úèÔ∏è Edit Report Text (Admin Only):</label>
            <textarea name="executive_summary">{{ config.executive_summary }}</textarea>
            <div style="text-align:right; margin-top:5px;">
                <button type="submit" class="save-btn">üíæ Save Changes</button>
            </div>
        </form>
    {% else %}
        <p style="font-size:14px; margin-bottom:25px; line-height: 1.5;">{{ config.executive_summary }}</p>
    {% endif %}

    <table>
        <thead>
            <tr>
                <th rowspan="2" class="head-gray" style="width: 5%;">ID</th>
                <th rowspan="2" class="head-gray" style="width: 10%;">Area</th>
                <th rowspan="2" class="head-gray" style="width: 10%;">Risk Owner</th>
                <th rowspan="2" class="head-gray" style="width: 25%;">Risk Details (Desc, Cause, Impact)</th>
                <th colspan="3" class="head-inherent">üî¥ INHERENT RISK (Before)</th>
                <th colspan="3" class="head-residual">üü¢ RESIDUAL RISK (After)</th>
            </tr>
            <tr>
                <th style="width: 6%; text-align:center;">Prob</th>
                <th style="width: 6%; text-align:center;">Impact</th>
                <th style="width: 6%; text-align:center;">Rating</th>
                <th style="width: 6%; text-align:center;">Prob</th>
                <th style="width: 6%; text-align:center;">Impact</th>
                <th style="width: 6%; text-align:center;">Rating</th>
            </tr>
        </thead>
        <tbody>
            {% for risk in risks %}
            <tr>
                <td style="font-weight:bold;">{{ risk.reference_id }}</td>
                <td>{{ risk.area_name }}</td>
                <td>{{ risk.risk_owner }}</td>
                <td>
                    <div style="color: #002366; font-weight: 900; font-size: 15px; margin-bottom: 5px;">
                        <span style="color: #000; font-weight: bold;">Description:</span> {{ risk.description }}
                    </div>
                    
                    <div style="color: #8B0000; font-weight: 800; border-top: 1px solid #ccc; padding-top: 4px; margin-bottom: 5px;">
                        <span style="color: #000; font-weight: bold;">Root Cause:</span> {{ risk.caused_by }}
                    </div>

                    <div style="color: #4B0082; font-weight: 800; border-top: 1px solid #ccc; padding-top: 4px;">
                        <span style="color: #000; font-weight: bold;">Consequences:</span> {{ risk.consequences }}
                    </div>
                </td>
                
                <td style="text-align:center; vertical-align: middle;">{{ risk.inherent_probability }}</td>
                <td style="text-align:center; vertical-align: middle;">{{ risk.inherent_impact }}</td>
                <td class="rating-{{ risk.inherent_rating }}" style="text-align:center; vertical-align: middle;">{{ risk.inherent_rating }}</td>

                <td style="text-align:center; vertical-align: middle;">{{ risk.residual_probability }}</td>
                <td style="text-align:center; vertical-align: middle;">{{ risk.residual_impact }}</td>
                <td class="rating-{{ risk.residual_rating }}" style="text-align:center; vertical-align: middle;">{{ risk.residual_rating }}</td>
            </tr>
            {% empty %}
            <tr><td colspan="10" style="text-align:center; padding: 20px;">No risks recorded.</td></tr>
            {% endfor %}
        </tbody>
    </table>

    <div class="signatures">
        <div class="sig-block">Chief Risk Officer<br><small>(Sign & Date)</small></div>
        <div class="sig-block">Internal Auditor<br><small>(Sign & Date)</small></div>
        <div class="sig-block">Board Chairman<br><small>(Sign & Date)</small></div>
    </div>

</body>
</html>